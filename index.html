<!DOCTYPE html>
<html>
<head>
  <title>Outlet Dashboard</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    label { margin-right: 10px; }
    select, input, button { margin: 5px; padding: 5px; }
    table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    .negative { background-color: #ffdddd; color: red; }
    .positive { background-color: #ddffdd; color: green; }
  </style>
</head>
<body>

<h2>Outlet Sales Dashboard</h2>

<label>Distribution:</label>
<select id="distributionSelect" onchange="loadRoutes()"></select>

<label>Route:</label>
<select id="routeSelect"></select>

<label>Day:</label>
<select id="daySelect">
  <option value="Mon">Mon</option>
  <option value="Tue">Tue</option>
  <option value="Wed">Wed</option>
  <option value="Thu">Thu</option>
  <option value="Fri">Fri</option>
  <option value="Sat">Sat</option>
  <option value="Sun">Sun</option>
</select>

<button onclick="filterData()">Generate</button>

<table id="dataTable">
  <thead>
    <tr>
      <th>Outlet</th>
      <th>Target</th>
      <th>MTD Sale</th>
      <th>Remaining</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let data = [];

fetch('data.json')
  .then(response => response.json())
  .then(json => {
    data = json;
    loadDistributions();
  });

function loadDistributions() {
  const distSelect = document.getElementById('distributionSelect');
  const uniqueDists = [...new Set(data.map(d => d.Distribution))];
  distSelect.innerHTML = '<option value="">Select</option>' + uniqueDists.map(d => `<option>${d}</option>`).join('');
}

function loadRoutes() {
  const selectedDist = document.getElementById('distributionSelect').value;
  const routeSelect = document.getElementById('routeSelect');
  const filtered = data.filter(d => d.Distribution === selectedDist);
  const uniqueRoutes = [...new Set(filtered.map(d => d["Route Title"]))];
  routeSelect.innerHTML = '<option value="">Select</option>' + uniqueRoutes.map(r => `<option>${r}</option>`).join('');
}

function filterData() {
  const dist = document.getElementById('distributionSelect').value;
  const route = document.getElementById('routeSelect').value;
  const day = document.getElementById('daySelect').value;

  if (!dist || !route || !day) {
    alert("Please select all fields: Distribution, Route, and Day.");
    return;
  }

  const filtered = data.filter(d =>
    d.Distribution === dist &&
    d["Route Title"] === route &&
    d[day] == 1
  );

  const tbody = document.querySelector('#dataTable tbody');
  tbody.innerHTML = filtered.map(row => {
    const remainingClass = row.Remaining < 0 ? 'negative' : 'positive';
    return `
      <tr>
        <td>${row.OutletCode} â€“ ${row.Outlet}</td>
        <td>${row.Target}</td>
        <td>${row.MTD_Sale}</td>
        <td class="${remainingClass}">${row.Remaining}</td>
      </tr>
    `;
  }).join('');
}
</script>

</body>
</html>
